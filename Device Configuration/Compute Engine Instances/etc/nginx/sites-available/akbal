server {

	root /webroot/akbal.dev;
	index index.html index.php index.htm;

	server_name www.akbal.dev akbal.dev;

# GZIP
	gzip on;
	gzip_comp_level 2;
	gzip_http_version 1.0;
	gzip_proxied any;
	gzip_min_length 1000;
	gzip_buffers 16 8k;
	gzip_types text/plain text/html text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;

	# Disable for IE < 6 because there are some known problems
	gzip_disable "MSIE [1-6].(?!.*SV1)";

	# Add a vary header for downstream proxies to avoid sending cached gzipped files to IE6
	gzip_vary on;

# LOGS
	access_log /var/log/nginx/akbal.dev-access.log;
	error_log /var/log/nginx/akbal.dev-error.log;

# Funcionamiento

	location / {

		try_files $uri $uri/ =404;

	}

	location /stats {

	auth_basic "Autentificate broder";
	auth_basic_user_file /etc/nginx/passwd/.htpasswd;

	}
	
# Errores 

	error_page 404 /404.html;
		location = /404.html {
		root /webroot/akbal.dev/errors;
		internal;
	}

	error_page 403 /403.html;
	        location = /403.html {
        	root /webroot/akbal.dev/errors;
        	internal;
        }

	error_page 401 /401.html;
        	location = /401.html {
        	root /webroot/akbal.dev/errors;
        	internal;
        }

	error_page 400 /400.html;
                location = /400.html {
                root /webroot/akbal.dev/errors;
                internal;
        }






# PHP 

	location ~ \.php$ {

	        include snippets/fastcgi-php.conf;
        	fastcgi_pass unix:/var/run/php/php7.3-fpm.sock;
		include fastcgi_params;
	}


# WEBMIN

#	location /webmin {
#		try_files $uri $uri/ =404;
#		auth_basic "Acceso Restringido";
#    auth_basic_user_file /etc/nginx/passwd/.htpasswd;
#	}



    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/akbal.dev/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/akbal.dev/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot


}
server {
    if ($host = www.akbal.dev) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    if ($host = akbal.dev) {
        return 301 https://$host$request_uri;
    } # managed by Certbot



	server_name www.akbal.dev akbal.dev;
    listen 80;
    return 404; # managed by Certbot




}